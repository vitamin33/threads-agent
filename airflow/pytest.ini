[tool:pytest]
# Pytest configuration for Airflow operators testing (CRA-284)

# Test discovery
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Markers for different test categories
markers =
    # Integration testing markers
    integration: Integration tests requiring multiple services
    e2e: End-to-end tests requiring full system stack
    
    # Contract testing markers
    contract: API contract validation tests
    version: API version compatibility tests
    
    # Performance testing markers
    performance: Performance and benchmarking tests
    regression: Performance regression detection tests
    
    # Security testing markers  
    security: Security and vulnerability tests
    
    # Chaos testing markers
    chaos: Chaos engineering and failure scenario tests
    
    # Monitoring specific markers
    monitoring: Tests for monitoring system integration
    prometheus: Prometheus metrics integration tests
    grafana: Grafana dashboard integration tests
    alertmanager: AlertManager integration tests
    
    # Test execution speed markers
    fast: Tests that complete in under 100ms
    slow: Tests that may take longer than 1 second
    
    # CI/CD markers
    ci: Tests suitable for CI pipeline execution
    local: Tests requiring local development environment
    
    # Service-specific markers
    health_check: Health check operator tests
    metrics_collection: Metrics collection operator tests
    
    # Environment markers
    requires_k8s: Tests requiring Kubernetes cluster
    requires_network: Tests requiring network connectivity
    requires_external_services: Tests requiring external service dependencies

# Test output configuration
addopts = 
    -v
    --strict-markers
    --tb=short
    --disable-warnings
    --cov=operators
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-report=xml:coverage.xml
    --cov-fail-under=90
    --durations=10
    --junit-xml=test-results.xml

# Minimum version requirements
minversion = 6.0

# Test timeout configuration (in seconds)
timeout = 60
timeout_method = thread

# Logging configuration
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Warnings configuration
filterwarnings =
    ignore::UserWarning
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::ResourceWarning
    # Ignore specific warnings from dependencies
    ignore:.*requests.*:urllib3.exceptions.InsecureRequestWarning
    ignore:.*unclosed.*:ResourceWarning

# Test collection configuration
collect_ignore = [
    "setup.py",
    "conftest.py"
]

# Parallel execution configuration
# Uncomment to enable parallel test execution
# -n auto
# --dist worksteal

# Test environment variables
env =
    TESTING = true
    AIRFLOW_HOME = /tmp/airflow_test
    PYTHONPATH = .
    # Disable external integrations during testing
    PROMETHEUS_URL = http://mock-prometheus:9090
    GRAFANA_URL = http://mock-grafana:3000
    ALERTMANAGER_URL = http://mock-alertmanager:9093