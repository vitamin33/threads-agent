# Root pytest configuration

import os
import sys

# Clean up Kubernetes environment variables that interfere with tests
for key in list(os.environ.keys()):
    if (
        key.endswith("_PORT")
        and isinstance(os.environ.get(key), str)
        and os.environ[key].startswith("tcp://")
    ):
        del os.environ[key]

# Set default test environment variables
os.environ.setdefault("DATABASE_URL", "sqlite:///./test.db")
os.environ.setdefault("OPENAI_API_KEY", "test-key")
os.environ.setdefault("RABBITMQ_URL", "amqp://guest:guest@localhost:5672/")
os.environ.setdefault("QDRANT_URL", "http://localhost:6333")
os.environ.setdefault("PROMETHEUS_URL", "http://localhost:9090")

# Add project root to Python path
sys.path.insert(0, os.path.abspath(os.path.dirname(__file__)))
